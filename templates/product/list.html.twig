{% extends 'base.html.twig' %}

{% block title %}Liste des Produits{% endblock %}

{% block body %}
    <form method="get" action="{{ path('app_product_list') }}">
        <!-- Champ de recherche -->
        <input
                type="text"
                name="search"
                placeholder="Search products..."
                value="{{ search|e }}"
                class="border rounded p-2"
        />

        <!-- Filtre par catégorie -->
        <select name="category" class="border rounded p-2">
            <option value="">All Categories</option>
            {% for category in categories %}
                <option
                        value="{{ category.id }}"
                        {% if category.id == categoryFilter %}selected{% endif %}
                >
                    {{ category.name }}
                </option>
            {% endfor %}
        </select>

        <button type="submit" class="bg-blue-500 text-white p-2 rounded">Filter</button>
    </form>
    <div class="flex flex-col sm:flex-row">
        <a class="mt-3 text-gray-600 hover:underline sm:mx-3 sm:mt-0" href="{{ path('app_product_list') }}">Reset</a>
    </div>
    <div class="container mx-auto px-6 mt-8">
        <h1 class="text-3xl font-bold text-center text-gray-700">Liste des Produits</h1>
        {% for categoryName, products in productsByCategory %}
            <div class="mt-16">
                <h3 class="text-gray-600 text-2xl font-medium">{{ categoryName }}</h3>
                <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 mt-6">
                    {% for product in products %}
                        <div class="bg-white rounded-lg shadow-md p-4 hover:shadow-lg transition duration-300">
                            {% if product.imageName %}
                                <img src="{{ product.imageName }}"
                                     class="w-full h-40 object-cover rounded-t-lg">
                            {% endif %}
                            <div class="p-4">
                                <h2 class="text-xl font-semibold text-gray-800">{{ product.title }}</h2>
                                <p class="text-gray-600 mt-2">
                                    {{ product.description|length > 100
                                    ? product.description[:100] ~ '...'
                                    : product.description }}
                                </p>
                                <p class="text-lg font-bold text-gray-800 mt-2">{{ product.price }} €</p>
                                <div class="mt-4">
                                    <h3 class="text-sm font-semibold text-gray-600">Catégories :</h3>
                                    {% if product.categories is not empty %}
                                        <ul class="list-disc ml-5 mt-1">
                                            {% for category in product.categories %}
                                                <li>{{ category.name }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% else %}
                                        <p class="text-gray-500">Aucune catégorie.</p>
                                    {% endif %}
                                </div>
                                {% if app.user %}
                                    {% set isFavorite = product.id in favoriteProductIds %}
                                    <form action="{{ path(isFavorite ? 'remove_favorite' : 'add_favorite', {'id': product.id}) }}" method="POST">
                                        <button type="submit" class="mt-4 inline-block text-blue-600 hover:text-blue-500">
                                            {% if isFavorite %}
                                                Enlever des favoris
                                            {% else %}
                                                Ajouter aux favoris
                                            {% endif %}
                                        </button>
                                    </form>
                                {% endif %}

                                <a href="{{ path('product_show',{ id: product.id }) }}" class="mt-4 inline-block text-blue-600 hover:text-blue-500">Voir plus</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}
